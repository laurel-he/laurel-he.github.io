<!DOCTYPE html>
<html lang="en" >
<head>
    <script type="text/javascript"
        async
        src="https://cdnjs.cloudflare.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$']],
            displayMath: [['$$','$$']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: { equationNumbers: { autoNumber: "AMS" },
                extensions: ["AMSmath.js", "AMSsymbols.js"] }
        }
    });

    MathJax.Hub.Queue(function() {
        
        
        
        var all = MathJax.Hub.getAllJax(), i;
        for(i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="贺小娇" />
	
	
	
	<title>kafka学习 ｜ xiaoJiao</title>
	
    
    
    <meta name="description" content="环境安装 直接按照文档下载安装。需要注意的是： zookeeper直接使用curl或者wget下载的文件很可能会损坏，导致解压出错。 可以浏览器直接下载，下载好后通过scp传入到服务器中。 安装的时候，pyt" />
    

    
    
    <meta name="keywords" content="Hugo, blog, php, go" />
    

	
    
    <link rel="shortcut icon" href="https://laurel-he.github.io/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://laurel-he.github.io/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://laurel-he.github.io/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://laurel-he.github.io/css/highlight.css" />

    
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">主页</a>
            </li>
            
            <li>
                <a href="/categories/">分类</a>
            </li>
            
            <li>
                <a href="/tags/">标签</a>
            </li>
            
            <li>
                <a href="/year/">按年</a>
            </li>
            
            <li>
                <a href="/series/">系列</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://laurel-he.github.io/">
                    <span>xiaoJiao</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">贺胖娇的编程之旅......</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/laurel-he" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1570306409&amp;site=qq&amp;menu=yes" title="qq" target="_blank"><i class="ri-qq-fill"></i></a>
                
                
                
                <a href="https://stackoverflow.com/users/9809769/laurel-he" title="stack-overflow" target="_blank"><i class="ri-stack-overflow-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/3783884100" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                <a href="https://laurel-he.github.io/index.xml" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/queue/kafka/'>kafka学习</a></h2>
                        <span class="date">2021.07.27</span>
                    </div>
                    <div class="post_content markdown"><h2 id="环境安装">环境安装</h2>
<p>直接按照文档下载安装。需要注意的是： <br>
zookeeper直接使用curl或者wget下载的文件很可能会损坏，导致解压出错。
可以浏览器直接下载，下载好后通过scp传入到服务器中。</p>
<p>安装的时候，python需要读取env的数据，可能会有如下报错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">/usr/bin/env: ‘python’: No such file or directory
</code></pre></div><p>如果安装的是python3，需要注意读取的是/usr/bin/python，这里加一个软链接即可</p>
<h2 id="使用">使用</h2>
<p>php使用kafka目前最好的解决方案是使用rdKafka插件。</p>
<h2 id="注意">注意</h2>
<p>kafka的版本不兼容可能会导致读取的所有数据都是null</p>
<p><strong>学习kafka的验收标准是能够回答以下问题</strong>
（1）kafka是什么？ <br>
（2）kafka有什么作用？ <br>
（3）在哪些应用场景下可能用到kafka?举例说明 <br>
（4）如何使用kafka？使用步骤？ <br>
（5）kafka在php中如何使用？用原生代码实现基础使用 <br>
（6）在swoole中使用kafka <br>
（7）kafka和其他消息对比优缺点</p>
<h2 id="kafka是什么">kafka是什么</h2>
<p>kafka是一个消息系统，专为分布式高吞吐量系统而设计。
Kafka是一个分布式发布 - 订阅消息系统和一个强大的队列。
它可以处理大量的数据，能够将消息从一个端点传递到另一个端点。
Kafka适合离线和在线消息消费。
Kafka消息保留在磁盘上，并在群集内复制以防止数据丢失。
Kafka构建在ZooKeeper同步服务之上。
它与Apache Storm和Spark非常好地集成，用于实时流式数据分析。
简单来说，可以理解为一个实时的消息处理系统</p>
<h3 id="kafka的优点">kafka的优点</h3>
<p>以下是Kafka的几个好处 -
<strong>可靠性</strong> - Kafka是分布式，分区，复制和容错的。</p>
<p><strong>可扩展性</strong> - Kafka消息传递系统轻松缩放，无需停机。</p>
<p><strong>耐用性</strong> - Kafka使用分布式提交日志，这意味着消息会尽可能快地保留在磁盘上，因此它是持久的。</p>
<p><strong>性能</strong> - Kafka对于发布和订阅消息都具有高吞吐量。 即使存储了许多TB的消息，它也保持稳定的性能。</p>
<p>Kafka非常快，并保证零停机和零数据丢失。</p>
<h2 id="kafka有什么作用">kafka有什么作用</h2>
<h2 id="如何使用kafka">如何使用kafka</h2>
<h3 id="关键术语解析">关键术语解析</h3>
<h4 id="生产者和消费者producer和consumer">生产者和消费者(producer和consumer);</h4>
<p>生产者(producer)消息的发送者，消费者(consumer)是指消息的接收者和使用者</p>
<h4 id="event">Event</h4>
<p>Event（事件）代表过去发生的一个事实。简单理解就是一条消息、一条记录。Event 是不可变的，但是很活跃，经常从一个地方流向另一个地方。</p>
<h4 id="stream">Stream</h4>
<p>Stream 事件流表示运动中的相关事件。 当一个事件流进入 Kafka 之后，它就成为了一个 Topic 主题。</p>
<h4 id="broker">broker</h4>
<p>kafka集群中有很多台server,其中每一台server都可以存储消息，将每一台server称为一个kafka实例，也叫做broker</p>
<h4 id="topic">Topic</h4>
<p>一个逻辑概念，Topic 就是具体的事件流，也可以理解为一个 Topic 就是一个静止的 Stream。
Topic 把相关的 Event 组织在一起，并且保存。一个 Topic 就像数据库中的一张表。Partition 是最小的存储单元，掌握着一个 Topic 的部分数据。</p>
<h4 id="分区partition">分区(partition)</h4>
<p>每个topic都可以分成多个partition，每个partition在存储层面上是append log文件。
任何发布到此partition的消息都会被追加到对应的log文件底部
一个分区对应一个文件，可以将数据存储到不同的server中去，也可以负载均衡，容纳更多的消费者</p>
<h4 id="偏移量offset">偏移量(offset)</h4>
<p>一个分区对应一个磁盘上的文件，消息在文件中的位置就称为偏移量(offset)。offset是一个long型数字，
可以唯一标记一条消息。kafka没有提供其他额外的机制来存储offset，因此文件只能顺序的读写，在kafka中
几乎不允许对消息进行“随机读写”</p>
<h4 id="副本replicated">副本(replicated)</h4>
<p>kafka可以配置partitions需要备份的个数(replicas)，每个partitions可以被备份到多台机器上，
以提高可用性，备份的数量可以通过配置文件指定</p>
<h3 id="生产一条数据流程">生产一条数据流程</h3>
<p>生产者添加一条数据的的四个参数是:topic,partition,key,value。其中topic和value必须指定，其他参数可选</p>
<h3 id="消费一条数据流程">消费一条数据流程</h3>
<p>设置consumer，订阅topic，</p>
<h2 id="kafka在php中如何使用">kafka在php中如何使用</h2>
<p>一般来说，使用php的<a href="https://pecl.php.net/package/rdkafka">rdkafka</a></p>
<h1 id="命令">命令</h1>
<blockquote>
<p>启动zookeeper:在zookeeper目录执行 ./bin/zkServer.sh start
启动kafka服务器：./bin/kafka-server-start.sh config/server.properties
创建topic ./bin/kafka-topics.sh &ndash;create &ndash;zookeeper localhost:2181 &ndash;replication-factor 1 &ndash;partitions 1 &ndash;topic purchase_test
查看topic list ./bin/kafka-topics.sh &ndash;list &ndash;zookeeper localhost:2181
启动生产者./bin/kafka-console-producer.sh &ndash;broker-list localhost:9092 &ndash;topic purchase_test
启动消费者./bin/kafka-console-consumer.sh &ndash;bootstrap-server localhost:9092 &ndash;topic purchase_test &ndash;from-beginning
创建消费者组：javac -cp &ldquo;/home/hexiaojiao/kafka/zookeeper/kafka_2.11-0.9.0.0/libs/*&rdquo; ConsumerGroup.java
./bin/kafka-console-consumer.sh &ndash;bootstrap-server localhost:9092 &ndash;topic purchase-test &ndash;from-beginning
./bin/kafka-console-consumer.sh &ndash;zookeeper 49.235.238.17:2181 &ndash;bootstrap-server 49.235.238.17:9092 &ndash;topic purchase-test &ndash;from-beginning</p>
</blockquote>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://laurel-he.github.io/tags/%E5%AD%A6%E4%B9%A0/">学习</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                
<div class="doc_comments">
    <div class="comments_block_title">发表评论</div>
    <div id="vcomments"></div>
</div>

<link rel="stylesheet" href="https://laurel-he.github.io/css/comments.css" />
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        appId: 'SWEItAag34n7U5AR3T95AhRG-gzGzoHsz',
        appKey: 'zAM901B4LKIxfrnTb7ie5e5K',
        placeholder: '在此输入评论...',
        visitor: 'true',
    })
</script>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <script type="text/javascript"
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span>绝知此事要躬行</span>
    </div>
</footer>
    <script src="https://laurel-he.github.io/js/jquery-3.5.1.min.js"></script>
<link href="https://laurel-he.github.io/css/fancybox.min.css" rel="stylesheet">
<script src="https://laurel-he.github.io/js/fancybox.min.js"></script>
<script src="https://laurel-he.github.io/js/zozo.js"></script>




</body>

</html>